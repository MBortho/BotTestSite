<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HANS HQ • FAQ Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="data:,">
  <style>
    :root{
      --bg:#0b1020; --ink:#0f172a; --ink-2:#334155;
      --brand:#2563eb; --brand-2:#1e40af; --ring:rgba(37,99,235,.4);
      --panel:#ffffff; --muted:#6b7280; --page:#0a0f1d;
      --card-w: 960px;                                  /* page card max width */
      --chat-w: 720px;                                  /* chat max width (desktop) */
      --chat-h: clamp(520px, 70vh, 680px);              /* fixed viewport height */
      --side-pad: 20px;
    }
    @media (prefers-color-scheme: light){
      :root{ --panel:#ffffff; --page:#f6f7f9; --ink:#0f172a; --muted:#6b7280; }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    html,body{overflow-x:hidden} /* hard stop on sideways scroll */
    body{margin:0; font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink); background:var(--page)}

    /* Header */
    .site-header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(180%) blur(6px);
      background:color-mix(in oklab, var(--page) 92%, #0000);
      border-bottom:1px solid color-mix(in oklab, var(--ink) 10%, #0000);
    }
    .nav{max-width:var(--card-w); margin:0 auto; padding:10px var(--side-pad); display:flex; align-items:center; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; font-weight:700}
    .brand-badge{
      width:28px; height:28px; border-radius:8px;
      background:linear-gradient(135deg,var(--brand),var(--brand-2));
      color:#fff; display:grid; place-items:center; font-weight:800; font-size:13px;
      box-shadow:0 4px 14px rgba(37,99,235,.35);
    }
    .nav-fill{flex:1}
    .btn{appearance:none; border:1px solid color-mix(in oklab,var(--ink) 16%, #0000); background:transparent; color:var(--ink);
      border-radius:10px; padding:8px 12px; font-weight:600; cursor:pointer}
    .btn:focus-visible{outline:3px solid var(--ring); outline-offset:2px}

    /* Hero */
    .hero{
      background: radial-gradient(1200px 420px at 50% -80px, color-mix(in oklab, var(--brand) 18%, #fff0), transparent), var(--bg);
      color:#e5ecff;
    }
    .hero-inner{max-width:var(--card-w); margin:0 auto; padding:44px var(--side-pad) 28px}
    .hero h1{margin:6px 0 8px; font-size:32px; line-height:1.2}
    .hero p{margin:0; color:#cdd8ff}

    /* Main card */
    .wrap{max-width:var(--card-w); margin:0 auto; padding:22px var(--side-pad) 40px}
    .card{
      background:var(--panel);
      border:1px solid color-mix(in oklab,var(--ink) 10%, #0000);
      border-radius:16px;
      box-shadow:0 10px 28px rgba(0,0,0,.08);
      overflow:hidden;
    }
    .card-head{padding:18px 18px 0}
    .card-head h2{margin:0 0 6px; font-size:18px}
    .card-head p{margin:0 0 16px; color:var(--muted)}
    .meta{display:flex; gap:12px; flex-wrap:wrap; padding:0 18px 16px}
    .pill{display:inline-flex; gap:8px; align-items:center; border:1px solid color-mix(in oklab,#fff 0%, var(--ink) 18%); border-radius:999px; padding:6px 10px; font-size:12px; color:var(--muted)}

    /* Fixed-size, centered chat viewport */
    .chat-shell{padding:0 0 18px; display:grid; place-items:center}
    .chat-frame{
      width:100%;
      max-width: min(var(--chat-w), calc(100vw - (var(--side-pad) * 2))); /* never exceed page */
      height: var(--chat-h);
      background:var(--panel);
      border-top:1px solid color-mix(in oklab,var(--ink) 8%, #0000);
      border-radius:12px;
      overflow:hidden; /* transcript scrolls inside */
    }
    #webchat{height:100%; width:100%}

    /* Web Chat polish + overflow guards */
    #webchat, #webchat .webchat__stacked-layout, #webchat .webchat__basic-transcript { background:var(--panel); }
    #webchat .webchat__stacked-layout{ --webchat__avatar-size:0px; width:100% }
    #webchat .webchat__avatar{ display:none !important; }
    #webchat .webchat__basic-transcript{ padding-left:6px; padding-right:6px; overflow-x:hidden } /* stop sideways scroll */
    #webchat .webchat__basic-transcript__activity{ padding:6px 10px; }

    /* Bubbles */
    #webchat .webchat__bubble{ border-radius:12px; border:1px solid color-mix(in oklab,var(--ink) 10%, #0000); box-shadow:0 6px 18px rgba(0,0,0,.06); }
    #webchat .webchat__bubble__content{ padding:10px 12px; max-width:100% }

    /* --- CRITICAL WRAPPING FIXES --- */
    /* Keep bubbles comfortably narrower than viewport */
    #webchat .webchat__bubble__content > * { max-width:100% }
    /* Wrap long words/URLs in text */
    #webchat .ac-textBlock, #webchat .webchat__bubble .markdown, #webchat .webchat__bubble p { overflow-wrap:anywhere; word-break:break-word; }

    /* Adaptive Cards: don't let columns or images overflow */
    #webchat .ac-container, #webchat .ac-columnSet, #webchat .ac-column, #webchat .ac-image { max-width:100% !important; }

    /* Action buttons in cards: allow wrapping & full width */
    #webchat .ac-actionSet, #webchat .ac-actionSet > * { max-width:100% !important; }
    #webchat .ac-pushButton, #webchat .ac-actionSet button {
      white-space: normal !important;
      overflow-wrap: anywhere !important;
      max-width:100% !important;
    }

    /* Suggested actions (chips) */
    #webchat .webchat__suggested-actions__button {
      max-width:100%;
      white-space: normal !important;
      overflow-wrap:anywhere !important;
    }
    #webchat .webchat__suggested-actions__carousel .webchat__carousel__content{
      max-width:100%;
      overflow-x:auto; /* allow scroll within chips row if needed */
      gap:8px;
      padding-inline:2px;
    }

    /* Send box */
    #webchat .webchat__send-box{ border-top:1px solid color-mix(in oklab,var(--ink) 12%, #0000); background:var(--panel) }
    #webchat .webchat__send-box-text-box__text-area{ padding:8px 10px !important }

    /* Mobile */
    @media (max-width: 640px){
      :root{ --chat-w: 100%; }
      .hero h1{font-size:26px}
      .chat-frame{ height: 70vh; }  /* fixed viewport on phones */
    }

    footer{padding:22px 0; color:var(--muted); text-align:center}
  </style>

  <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
</head>
<body>
  <div class="site-header" role="banner">
    <div class="nav">
      <div class="brand"><div class="brand-badge">HQ</div><div>HANS HQ</div></div>
      <div class="nav-fill"></div>
      <button class="btn" id="themeToggle" aria-label="Toggle theme">Toggle theme</button>
    </div>
  </div>

  <header class="hero">
    <div class="hero-inner">
      <h1>HANS HQ — FAQ Assistant</h1>
      <p>Temporary access while the main site is being finalized. Use the assistant below to learn about HANS HQ, setup, pricing, and support.</p>
    </div>
  </header>

  <main class="wrap" role="main">
    <section class="card" aria-label="Chat">
      <div class="card-head">
        <h2>Ask a question</h2>
        <p>Examples: “What is HANS HQ?”, “How do I get started?”, “Is PHI collected?”</p>
        <div class="meta">
          <span class="pill">No PHI</span>
          <span class="pill">Marketing-friendly</span>
          <span class="pill">Buttons or free-text</span>
        </div>
      </div>
      <div class="chat-shell">
        <div id="webchat" class="chat-frame" aria-label="Chat window"></div>
      </div>
    </section>
  </main>

  <footer>© <span id="year"></span> Ortho Molecular Products</footer>

  <script>
    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
      const current = document.documentElement.style.colorScheme ||
        (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.documentElement.style.colorScheme = current === 'dark' ? 'light' : 'dark';
    });

    // Web Chat
    (async function () {
      const TOKEN_URL = 'https://orthohqbot-cgc2dgdac5b3daaa.centralus-01.azurewebsites.net/api/directline/token';
      const el = document.getElementById('webchat');
      el.innerHTML =
        '<div style="height:100%;display:grid;place-items:center;color:var(--muted)">Loading assistant…</div>';

      try {
        const res = await fetch(TOKEN_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('Token fetch failed: ' + res.status);
        const { token } = await res.json();

        const brand  = getComputedStyle(document.documentElement).getPropertyValue('--brand').trim();
        const brand2 = getComputedStyle(document.documentElement).getPropertyValue('--brand-2').trim();
        const subtle = getComputedStyle(document.documentElement).getPropertyValue('--muted').trim();

        const directLine = window.WebChat.createDirectLine({ token });

        const styleOptions = {
          primaryFont: 'system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif',
          fontSize: '13px',
          bubbleBorderRadius: 12,
          bubbleFromUserBorderRadius: 12,
          bubbleNubSize: 0,
          bubbleFromUserNubSize: 0,
          hideBotAvatar: true,
          hideUserAvatar: true,

          /* Keep bubbles well inside the frame to avoid any edge-case overflow */
          bubbleMaxWidth: 560,

          sendBoxPlaceholder: 'Type your question…',
          sendBoxButtonColor: brand,
          sendBoxButtonColorOnHover: brand2,
          subtle,
          suggestedActionsLayout: matchMedia('(max-width: 520px)').matches ? 'stacked' : 'carousel'
        };

        const adaptiveCardsHostConfig = {
          fontFamily: getComputedStyle(document.body).fontFamily,
          spacing: { small: 6, default: 12, medium: 16, large: 18, extraLarge: 24, padding: 12 },
          separator: { lineThickness: 1, lineColor: 'rgba(0,0,0,0.10)' },
          containerStyles: { default: { backgroundColor: 'transparent' } }
        };

        el.innerHTML = '';
        window.WebChat.renderWebChat({ directLine, styleOptions, adaptiveCardsHostConfig, locale: 'en-US' }, el);
      } catch (e) {
        console.error(e);
        el.innerHTML =
          '<div style="height:100%;display:grid;place-items:center;color:#b91c1c">We couldn’t start the assistant. Please refresh this page.</div>';
      }
    })();
  </script>
</body>
</html>
