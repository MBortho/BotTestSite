<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>HANS HQ • Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <link rel="icon" href="data:,">
  <style>
   :root{
  --bg:#212121;             /* your chosen dark gray */
  --ink:#e5e5e5;            /* white-ish text */
  --muted:#a1a1a1;          /* muted gray for footer or system text */
  --surface:#2b2b2b;        /* input field background */
  --brand:#3b82f6;          /* blue send button */
  --brand-2:#2563eb;        /* hover blue */
  --col-max:760px;
  --header-h:56px;
  --side-pad:16px;
}

/* === Page Layout === */
body{
  background:var(--bg);
  color:var(--ink);
  font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  margin:0;
  display:flex; flex-direction:column;
}

/* === Chat Styling === */
#webchat, #webchat .webchat__stacked-layout, #webchat .webchat__basic-transcript {
  background:transparent !important;
}

#webchat .webchat__stacked-layout{
  --webchat__avatar-size:0px;
}

#webchat .webchat__avatar{ display:none !important; }

/* Transcript scroll + padding */
#webchat .webchat__basic-transcript{
  height:100% !important;
  overflow-y:auto !important;
  padding:0 20px;
}

/* Hide timestamps and status lines */
#webchat .webchat__timestamp,
#webchat .webchat__row .webchat__status{
  display:none !important;
}

/* === Bubbles (transparent) === */
#webchat .webchat__bubble{
  background:transparent !important;
  border:none !important;
  box-shadow:none !important;
  color:var(--ink);
  border-radius:10px;
  max-width: calc(100% - 48px);
  padding:0 !important;
}

#webchat .webchat__bubble__content{
  padding:4px 0;
  background:transparent !important;
}

/* User bubble text color */
#webchat .webchat__bubble--from-user .webchat__bubble__content{
  color:var(--ink);
}

/* === Input Bar === */
#webchat .webchat__send-box{
  background:var(--bg);
  border-top:1px solid #383838;
  padding:12px 0 16px;
}

#webchat .webchat__send-box-text-box__text-area{
  background:var(--surface) !important;
  color:var(--ink) !important;
  border:1px solid #3a3a3a !important;
  border-radius:14px !important;
  padding:12px 12px !important;
}

#webchat .webchat__send-box-text-box__text-area::placeholder{
  color:#bdbdbd;
}

/* === Send button === */
#webchat .webchat__send-box__button{
  color:var(--brand) !important;
}
#webchat .webchat__send-box__button:hover{
  color:var(--brand-2) !important;
}

/* === Suggested action chips === */
#webchat .webchat__suggested-actions__button{
  background:#2b2b2b; 
  color:#e5e5e5;
  border:1px solid #3a3a3a;
  border-radius:8px;
  padding:6px 10px;
}
#webchat .webchat__suggested-actions__button:hover{
  background:#383838;
}

  </style>

  <script src="https://cdn.botframework.com/botframework-webchat/latest/webchat.js"></script>
</head>
<body>
  <div class="top">
    <div class="brand"><div class="badge">HQ</div> HANS HQ</div>
  </div>

  <div class="app">
    <div class="col">
      <div class="chat-root">
        <div id="webchat" role="main" aria-label="Chat window"></div>
      </div>
      <footer>© <span id="year"></span> Ortho Molecular Products</footer>
    </div>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    (async function () {
      const TOKEN_URL = 'https://orthohqbot-cgc2dgdac5b3daaa.centralus-01.azurewebsites.net/api/directline/token';
      const el = document.getElementById('webchat');

      // ✅ Restored auto-scroll middleware that worked earlier
      const store = window.WebChat.createStore({}, () => next => action => {
        const result = next(action);
        if (
          action.type === 'DIRECT_LINE/INCOMING_ACTIVITY' ||
          action.type === 'DIRECT_LINE/POST_ACTIVITY_FULFILLED' ||
          action.type === 'WEB_CHAT/SUGGESTED_ACTIONS/SET'
        ) {
          setTimeout(() => store.dispatch({ type: 'WEB_CHAT/SCROLL_TO_END', payload: { behavior: 'smooth' } }), 0);
        }
        return result;
      });

      try {
        const res = await fetch(TOKEN_URL, { cache: 'no-store' });
        if (!res.ok) throw new Error('Token fetch failed: ' + res.status);
        const { token } = await res.json();

        const brand  = getComputedStyle(document.documentElement).getPropertyValue('--brand').trim();
        const brand2 = getComputedStyle(document.documentElement).getPropertyValue('--brand-2').trim();

        const directLine = window.WebChat.createDirectLine({ token });

        const styleOptions = {
          primaryFont: 'system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif',
          fontSize: 15,
          bubbleBorderRadius: 14,
          bubbleFromUserBorderRadius: 14,
          bubbleNubSize: 0,
          hideUploadButton: true,
          hideBotAvatar: true,
          hideUserAvatar: true,
          sendBoxHeight: 56,
          sendBoxPlaceholder: 'Type your message…',
          sendBoxButtonColor: brand,
          sendBoxButtonColorOnHover: brand2,
          backgroundColor: 'transparent',
          bubbleMaxWidth: 640
        };

        window.WebChat.renderWebChat({ directLine, styleOptions, store, locale: 'en-US' }, el);

        // Jump to bottom on first render
        store.dispatch({ type: 'WEB_CHAT/SCROLL_TO_END', payload: { behavior: 'auto' } });
      } catch (e) {
        console.error(e);
        el.innerHTML = '<div style="padding:12px;color:#b91c1c">Failed to load chat. Please refresh.</div>';
      }
    })();
  </script>
</body>
</html>


